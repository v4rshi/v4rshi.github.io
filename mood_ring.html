<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V's Music Mood Ring</title>
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&display=swap" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Kirang+Haerang' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ... (previous styles remain the same) ... */

        .recommendation strong {
            font-size: 16px;
            margin-bottom: 5px;
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
        }

        /* Updated animation for long track names */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .recommendation strong.animate {
            white-space: nowrap;
            overflow: hidden;
            display: inline-block;
            animation: marquee 10s linear infinite;
            animation-play-state: paused;
        }

        .recommendation strong.animate:hover {
            animation-play-state: running;
        }

        .nav-button {
            background: #04d4ae;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #prevBtn {
            left: 10px;
        }

        #nextBtn {
            right: 10px;
        }

        .nav-button.visible {
            visibility: visible;
            opacity: 1;
        }

        /* ... (rest of the styles remain the same) ... */
    </style>
</head>
<body>
    <!-- ... (previous body content remains the same) ... -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const recommendations = {};
            let currentIndex = 0;
            let currentlyPlayingAudio = null;
            let totalRecommendations = 0;

            const sentimentSelect = document.getElementById('sentiment');
            const carouselDiv = document.getElementById('carousel');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const dotsContainer = document.querySelector('.carousel-dots');

            fetch('recommendations.json')
                .then(response => response.json())
                .then(data => {
                    Object.assign(recommendations, data);
                    const sentimentOptions = Object.keys(recommendations);
                    sentimentOptions.forEach(sentiment => {
                        const option = document.createElement('option');
                        option.value = sentiment;
                        option.text = sentiment;
                        sentimentSelect.add(option);
                    });
                });

            sentimentSelect.addEventListener('change', function() {
                const sentiment = this.value;
                const recs = recommendations[sentiment];
                totalRecommendations = recs.length;
                carouselDiv.innerHTML = '';
                dotsContainer.innerHTML = '';

                recs.forEach((rec, index) => {
                    const recDiv = document.createElement('div');
                    recDiv.className = 'recommendation';
                    recDiv.innerHTML = `
                        <img src="${rec['Album Art URL'] || '/api/placeholder/180/180'}" alt="Album Art" onerror="this.src='/api/placeholder/180/180';">
                        <strong class="track-name">${rec['Song Name']}</strong>
                        <div>${rec['Artist']}</div>
                        <a href="${rec['Spotify URL']}" target="_blank">Listen on Spotify</a>
                        <audio>
                            <source src="${rec['Preview URL'] || '#'}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                        <button class="play-pause-btn">Play</button>
                    `;
                    carouselDiv.appendChild(recDiv);

                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.addEventListener('click', () => goToSlide(index));
                    dotsContainer.appendChild(dot);

                    // Add marquee effect for long track names
                    const trackName = recDiv.querySelector('.track-name');
                    if (trackName.scrollWidth > trackName.clientWidth) {
                        trackName.classList.add('animate');
                    }
                });

                currentIndex = 0;
                updateCarousel();
                updateDots();

                prevBtn.classList.add('visible');
                nextBtn.classList.add('visible');
            });

            prevBtn.addEventListener('click', function() {
                stopCurrentAudio();
                currentIndex = (currentIndex - 1 + totalRecommendations) % totalRecommendations;
                updateCarousel();
                updateDots();
            });

            nextBtn.addEventListener('click', function() {
                stopCurrentAudio();
                currentIndex = (currentIndex + 1) % totalRecommendations;
                updateCarousel();
                updateDots();
            });

            carouselDiv.addEventListener('click', function(e) {
                if (e.target.classList.contains('play-pause-btn')) {
                    const audio = e.target.previousElementSibling;
                    if (audio.paused) {
                        stopCurrentAudio();
                        audio.play();
                        e.target.textContent = 'Pause';
                        currentlyPlayingAudio = audio;
                    } else {
                        audio.pause();
                        e.target.textContent = 'Play';
                        currentlyPlayingAudio = null;
                    }
                }
            });

            function updateCarousel() {
                const recommendationWidth = carouselDiv.querySelector('.recommendation').clientWidth;
                carouselDiv.style.transform = `translateX(-${currentIndex * recommendationWidth}px)`;
            }

            function goToSlide(index) {
                stopCurrentAudio();
                currentIndex = index;
                updateCarousel();
                updateDots();
            }

            function updateDots() {
                const dots = document.querySelectorAll('.dot');
                dots.forEach((dot, index) => {
                    if (index === currentIndex) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }

            function stopCurrentAudio() {
                if (currentlyPlayingAudio) {
                    currentlyPlayingAudio.pause();
                    currentlyPlayingAudio.currentTime = 0;
                    currentlyPlayingAudio.nextElementSibling.textContent = 'Play';
                    currentlyPlayingAudio = null;
                }
            }
        });
    </script>
</body>
</html>
